<!DOCTYPE html>
<html>
  <head>
    <title>my first game</title>
    <style>
      canvas {
        background: #000;
        display: block;
        margin: 0 auto;
      }
    </style>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <script>
      const KEYCODE_SPACE = 32;
      const KEYCODE_A = 65;
      const KEYCODE_LEFT = 37;
      const KEYCODE_D = 68;
      const KEYCODE_RIGHT = 39;

      const CANVAS_WIDTH = 700;
      const CANVAS_HEIGHT = 750;

      const SHIP_WIDTH = 30;
      const SHIP_HEIGHT = 20;
      const SHIP_SPEED = 5;

      const BULLET_WIDTH = 2;
      const BULLET_HEIGHT = 5;
      const BULLET_SPEED = 10;
      const TIME_BETWEEN_SHOTS = 10;

      let stage;

      let userR; //going right
      let userL; //going left
      let userShoot;

      let playerShip;
      let shipHP = 3;

      let bulletTime = TIME_BETWEEN_SHOTS;

      let aliens = [];
      let bullets = [];

      document.onkeydown = handleKeyDown;
      document.onkeyup = handleKeyUp;
      createjs.Ticker.addEventListener("tick", tick);

      function init() {
        stage = new createjs.Stage("gameCanvas");

        playerShip = new createjs.Shape();
        playerShip.graphics.beginFill("LimeGreen").drawRect(0, 0, SHIP_WIDTH, SHIP_HEIGHT);
        playerShip.x = (CANVAS_WIDTH - SHIP_WIDTH) / 2;
        playerShip.y = CANVAS_HEIGHT - SHIP_HEIGHT - 20;
        stage.addChild(playerShip);

        stage.update();
      }

      function handleKeyDown(e) {
        //cross browser problems
        if (!e) {
          var e = window.event;
        }

        switch (e.keyCode) {
          case KEYCODE_SPACE:
            userShoot = true;
            return false;

          case KEYCODE_A:
          case KEYCODE_LEFT:
            userL = true;
            return false;

          case KEYCODE_D:
          case KEYCODE_RIGHT:
            userR = true;
            return false;
        }
      }

      function handleKeyUp(e) {
        //cross browser problems
        if (!e) {
          var e = window.event;
        }

        switch (e.keyCode) {
          case KEYCODE_SPACE:
            userShoot = false;
            break;

          case KEYCODE_A:
          case KEYCODE_LEFT:
            userL = false;
            break;

          case KEYCODE_D:
          case KEYCODE_RIGHT:
            userR = false;
            break;
        }
      }

      function tick(event) {
        if (userL && playerShip.x > 0) {
          playerShip.x -= SHIP_SPEED;
        }

        if (userR && playerShip.x < CANVAS_WIDTH) {
          playerShip.x += SHIP_SPEED;
        }

        if (bulletTime <= 0) {
          if (userShoot) {
            let newBullet = new createjs.Shape();
            newBullet.graphics.beginFill("white").drawRect(0, 0, BULLET_WIDTH, BULLET_HEIGHT);
            newBullet.x = playerShip.x;
            newBullet.y = playerShip.y;

            bullets.push(newBullet);
            stage.addChild(newBullet);

            bulletTime = TIME_BETWEEN_SHOTS;
          }
        }
        else
          bulletTime--;

        updateBullets();
        stage.update();
      }

      function updateBullets() {
        if (bullets.length == 0)
          return;

        for (let bullet of bullets) {
          bullet.y -= BULLET_SPEED;
          //TODO check for target hit here
          
          if (bullet.y <= 0 && stage.contains(bullet)) {
            stage.removeChild(bullet);
          }
        }
      }
    </script>
  </head>
  <body onload="init();">
    <canvas id="gameCanvas" width="700" height="750"></canvas>
  </body>
</html>
